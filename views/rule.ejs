window.onload = function() {
  // Adjust this to tweak where the baseline is presented on the line of text
  var BASELINE_OFFSET = 0;

  // Whether to draw the canvas behind all other elements or in front
  var RULE_BEHIND = true;

  var body = document.getElementsByTagName('body')[0];
  var computedStyle = getComputedStyle(body, '');

  var fontSize = Number(computedStyle.fontSize.match(/(\d+)px/)[1]);
  var lineHeight = fontSize;

  if(computedStyle.lineHeight.match(/(\d+)px/)) {
    lineHeight = Number(computedStyle.lineHeight.match(/(\d+)px/)[1]);
  }

  console.log('[Gridder] Font size:', fontSize + 'px, line height:', lineHeight + 'px');

  // Set up the canvas to stretch across the page
  var canvas    = document.createElement('canvas');
  canvas.height = body.scrollHeight;
  canvas.width  = body.scrollWidth; 
  canvas.style.position = 'absolute';
  canvas.style.top  = 0;
  canvas.style.left = 0;

  if(RULE_BEHIND) {
    var firstElement = body.childNodes[0];
    body.insertBefore(canvas, firstElement);
  } else {
    body.appendChild(canvas);
  }

  // Drawing settings
  var ctx = canvas.getContext('2d');
  ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
  var y = 0 + BASELINE_OFFSET;
  var lineThickness = 1;
  var step = lineHeight;
  
  // Clear the canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Rule the lines
  while(y < canvas.height) {
    ctx.fillRect(0, y += step, canvas.width, lineThickness);
  }
};